// FB Controller for the FactoryIO Machining Station
// Robotic arm transports raw material to CNC machine when material is detected and oStart is TRUE
// Part detection is handled internally by FactoryIO
// iError is set when a non-material part is detected at entrance
// Proprties used to set/get Enabled, DoorOpened, Error, IsBusy, ProduceLids, and CNC Progress
FUNCTION_BLOCK FB_MachineCenter
VAR_INPUT
	iBusy : BOOL;				// TRUE when the station is processing raw material
	iOpened : BOOL;				// True when CNC machine door is open
	iError : BOOL;				// True when a non-material part is detected at entry
	iProgress : WORD;			// CNC machining progress (0 - 100)
END_VAR
VAR_OUTPUT
	oStart: BOOL;				// Start signal for MC, starts machining when part is detected at entry
	oStop: BOOL;				// MC Stop signal
	oReset: BOOL;				// MC Reset signal
	oProduceLids: BOOL;			// TRUE: MC produces lids, FALSE: MC produces bases
END_VAR
VAR
	bEnabled : BOOL;			// Enable/Disable Machining Station
	bProduction : BOOL;			// TRUE: Lids, FALSE: Bases
	bIsError : BOOL;			// True when a non-material part is detected at entry
	bIsDoorOpened : BOOL;		// True when CNC machine door is open
END_VAR


// Map variables to outputs
oStart := bEnable;
oProduceLids := bProduction;

// Safety stop
IF NOT GV_Flags.SystemEnabled THEN
	oStop := TRUE;
ELSE
	oStop := FALSE;
END_IF


PROPERTY bBusy : BOOL
GET
bBusy := iBusy;

PROPERTY bDoorOpened : BOOL
GET
bDoorOpened := iOpened;

PROPERTY bError : BOOL
GET
bError := iError;

PROPERTY wProgress : WORD
GET
wProgress := iProgress;

PROPERTY bEnable : BOOL
GET
bEnable := bEnabled;
SET
bEnabled := bEnable;

PROPERTY bProduceLids : BOOL
GET
bProduceLids := bProduction;
SET
bProduction := bProduceLids;